<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up</title>
    <style>
      /* Base styles */
      body {
        margin: 0;
        padding: 0;
        background: #f5f5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
      }

      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      /* Card styles */
      .card {
        width: auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        border-top: 4px solid #77ba99;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      /* Form styles */
      form {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        gap: 100px;
      }

      input {
        padding: 12px;
        border: none;
        background-color: transparent;
        border-bottom: 1px solid #ccc;
        color: #333;
        width: 100%;
        margin-bottom: 15px;
      }

      /* Select styles */
      .select-wrapper {
        position: relative;
        width: 100%;
        margin-bottom: 15px;
      }

      select {
        width: 100%;
        padding: 10px 30px 10px 10px;
        border: none;
        border-bottom: 1px solid #ccc;
        background-color: transparent;
        cursor: pointer;
        color: #333;
        font-size: 1em;
        appearance: none;
        transition: all 0.3s ease;
      }

      /* Select arrow */
      .select-wrapper::after {
        content: "";
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid #77ba99;
        pointer-events: none;
        transition: transform 0.3s ease;
        z-index: 1;
      }

      .select-wrapper:hover::after {
        transform: translateY(-50%) scale(1.2);
      }

      /* Select states */
      select:focus {
        outline: none;
        border-bottom: 2px solid #77ba99;
      }

      select:hover {
        background-color: #f8f8f8;
      }

      /* Firefox-specific styles */
      @-moz-document url-prefix() {
        select {
          text-indent: 0.01px;
          text-overflow: "";
        }

        select option {
          background-color: white;
          color: #333;
          padding: 10px;
        }

        select option:hover,
        select option:focus {
          background-color: #77ba99;
          color: white;
          box-shadow: 0 0 10px 100px #77ba99 inset;
        }
      }

      /* Disabled state */
      select:disabled {
        color: #999;
        border-bottom: 1px dashed #ccc;
        cursor: not-allowed;
        opacity: 0.7;
      }

      .select-wrapper:has(select:disabled)::after {
        border-top-color: #ccc;
        opacity: 0.7;
      }

      /* Error state */
      select.error {
        border-bottom: 1px solid #ff6b6b;
      }

      .select-wrapper:has(select.error)::after {
        border-top-color: #ff6b6b;
      }

      /* Button styles */
      .buttons {
        margin-top: 15px;
        display: flex;
        justify-content: flex-start;
        gap: 10px;
      }

      .login-button {
        padding: 10px 20px;
        background-color: #77ba99;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      /* Error message */
      .error-message {
        color: red;
        font-size: 12px;
        margin-top: -10px;
        margin-bottom: 10px;
      }

      /* Responsive styles */
      @media (max-width: 480px) {
        .card {
          width: 100%;
          max-width: 300px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <form id="signupForm" method="post" action="createUser">
          <div class="part1">
            <input
              type="text"
              id="full_name"
              name="full_name"
              placeholder="Enter full name"
              required
            />
            <div id="fullNameError" class="error-message"></div>

            <input
              type="text"
              id="user_name"
              name="user_name"
              placeholder="Enter username"
              required
            />
            <div id="userNameError" class="error-message"></div>

            <input
              type="password"
              id="password"
              name="password"
              placeholder="Enter password"
              required
            />
            <div id="passwordError" class="error-message"></div>

            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm password"
              required
            />
            <div id="confirmPasswordError" class="error-message"></div>

            <input
              type="tel"
              id="phone_number"
              name="phone_number"
              placeholder="Enter phone number"
              required
            />
            <div id="phoneError" class="error-message"></div>

            <div class="select-wrapper">
              <select id="role" name="role" required>
                <option value="" disabled selected>Select Role</option>
                <option value="student">Student</option>
                <option value="manager">Manager</option>
                <option value="teacher">Teacher</option>
                <option value="hod">Head of Department</option>
                <option value="librarian">Librarian</option>
              </select>
            </div>
            <div id="roleError" class="error-message"></div>

            <div class="select-wrapper">
              <select id="gender" name="gender" required>
                <option value="" disabled selected>Select Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div id="genderError" class="error-message"></div>

            <div class="buttons">
              <button type="submit" class="login-button">Register</button>
            </div>
          </div>

          <div class="part2">
            <div class="select-wrapper">
              <select
                id="province"
                name="province"
                onchange="fetchDistricts()"
                required
              >
                <option value="" disabled selected>Select Province</option>
              </select>
            </div>

            <div class="select-wrapper">
              <select
                id="district"
                name="district"
                onchange="fetchSectors()"
                required
              >
                <option value="" disabled selected>Select District</option>
              </select>
            </div>

            <div class="select-wrapper">
              <select
                id="sector"
                name="sector"
                onchange="fetchCells()"
                required
              >
                <option value="" disabled selected>Select Sector</option>
              </select>
            </div>

            <div class="select-wrapper">
              <select id="cell" name="cell" onchange="fetchVillages()" required>
                <option value="" disabled selected>Select Cell</option>
              </select>
            </div>

            <div class="select-wrapper">
              <select id="village" name="village" required>
                <option value="" disabled selected>Select Village</option>
              </select>
            </div>
          </div>
        </form>
      </div>
    </div>
    <script>
      const API_URL = "https://rwanda.p.rapidapi.com";
      const API_HEADERS = {
        "x-rapidapi-key": "2199840b10msh703983e3fedcdb6p1d3842jsn70a2ff40d543",
        "x-rapidapi-host": "rwanda.p.rapidapi.com",
      };

      document.addEventListener("DOMContentLoaded", () => {
        fetchProvinces();

        // Add form submission handler
        document
          .getElementById("signupForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            // Get full name and split it
            const fullName = document.getElementById("full_name").value;
            const nameParts = fullName.trim().split(/\s+/);

            if (nameParts.length < 2) {
              document.getElementById("fullNameError").textContent =
                "Please enter both first and last name";
              return;
            }

            // Create hidden inputs for first and last name
            const firstName = document.createElement("input");
            firstName.type = "hidden";
            firstName.name = "first_name";
            firstName.value = nameParts[0];

            const lastName = document.createElement("input");
            lastName.type = "hidden";
            lastName.name = "last_name";
            lastName.value = nameParts.slice(1).join(" ");

            this.appendChild(firstName);
            this.appendChild(lastName);

            // Submit the form
            this.submit();
          });
      });

      async function fetchProvinces() {
        try {
          const response = await fetch(`${API_URL}/provinces`, {
            headers: API_HEADERS,
          });
          const data = await response.json();
          populateDropdown("province", data?.data);
        } catch (error) {
          console.error("Error fetching provinces:", error);
        }
      }

      async function fetchDistricts() {
        const province = document.getElementById("province").value;
        try {
          const response = await fetch(`${API_URL}/districts?p=${province}`, {
            headers: API_HEADERS,
          });
          const data = await response.json();
          populateDropdown("district", data?.data);
        } catch (error) {
          console.error("Error fetching districts:", error);
        }
      }

      async function fetchSectors() {
        const province = document.getElementById("province").value;
        const district = document.getElementById("district").value;
        try {
          const response = await fetch(
            `${API_URL}/sectors?p=${province}&d=${district}`,
            { headers: API_HEADERS }
          );
          const data = await response.json();
          populateDropdown("sector", data?.data);
        } catch (error) {
          console.error("Error fetching sectors:", error);
        }
      }

      async function fetchCells() {
        const province = document.getElementById("province").value;
        const district = document.getElementById("district").value;
        const sector = document.getElementById("sector").value;
        try {
          const response = await fetch(
            `${API_URL}/cells?p=${province}&d=${district}&s=${sector}`,
            { headers: API_HEADERS }
          );
          const data = await response.json();
          populateDropdown("cell", data?.data);
        } catch (error) {
          console.error("Error fetching cells:", error);
        }
      }

      async function fetchVillages() {
        const province = document.getElementById("province").value;
        const district = document.getElementById("district").value;
        const sector = document.getElementById("sector").value;
        const cell = document.getElementById("cell").value;
        try {
          const response = await fetch(
            `${API_URL}/villages?p=${province}&d=${district}&s=${sector}&c=${cell}`,
            { headers: API_HEADERS }
          );
          const data = await response.json();
          populateDropdown("village", data?.data);
        } catch (error) {
          console.error("Error fetching villages:", error);
        }
      }

      function populateDropdown(id, items) {
        const dropdown = document.getElementById(id);
        dropdown.innerHTML = '<option value="">Select</option>';
        items.forEach((item) => {
          const option = document.createElement("option");
          option.value = item.toLowerCase();
          option.textContent = item;
          dropdown.appendChild(option);
        });
      }
    </script>
  </body>
</html>
